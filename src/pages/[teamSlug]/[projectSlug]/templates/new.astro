---
import ProjectLayout from '@/layouts/project/project-layout.astro'

import { EmailTemplateEditor } from '@/components/templates/email-template-editor'
import {
  EmailTemplateFixedToolbar,
  Action,
} from '@/components/templates/email-template-fixed-toolbar'
import { BreadcumbTemplateInputComponent } from '@/components/breadcrumb-template-input-component'
import { BreadcrumbItem, BreadcrumbSeparator } from '@/components/ui/breadcrumb'
import { SlashSvg } from '@/components/svg/slash'

import {
  DEFAULT_EMAIL_TEMPLATE_NAME,
  DEFAULT_SETTINGS,
  DEFAULT_EMOJI,
  DEFAULT_EMAIL_TEMPLATE_CONTENT,
} from '@/stores/template-store'

const csrfToken = Astro.locals.csrfToken!
const project = Astro.locals.project!

const emoji = JSON.stringify(DEFAULT_EMOJI) as string
const settings = JSON.stringify(DEFAULT_SETTINGS) as string
const content = JSON.stringify(DEFAULT_EMAIL_TEMPLATE_CONTENT) as string
---

<ProjectLayout>
  <Fragment slot="exstraBreadcrumbs">
    <BreadcrumbSeparator className="text-gray-300">
      <SlashSvg className="!size-6" />
    </BreadcrumbSeparator>
    <BreadcrumbItem className="font-semibold tracking-tight text-foreground">
      <BreadcumbTemplateInputComponent
        client:load
        csrfToken={csrfToken}
        name={DEFAULT_EMAIL_TEMPLATE_NAME}
        emoji={emoji}
        teamId={project.teamId}
        projectId={project.id}
      />
    </BreadcrumbItem>
  </Fragment>
  <EmailTemplateFixedToolbar
    csrfToken={csrfToken}
    teamId={project.teamId}
    projectId={project.id}
    action={Action.CREATE}
    settings={settings}
    client:load
  />
  <EmailTemplateEditor content={content} client:load settings={settings} />
</ProjectLayout>
